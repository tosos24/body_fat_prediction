# -*- coding: utf-8 -*-
"""app.py

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1EP-eeLEFpZZ2XKr4Xp8czgKWENLHJPen
"""

import gradio as gr
import pandas as pd
import numpy as np
import joblib

# Load model
def load_model():
    model_data = joblib.load('/content/drive/MyDrive/body fat predictor/model/best_model.pkl')
    return model_data

model_data = load_model()
model = model_data['model']
scaler = model_data['scaler']
feature_names = model_data['feature_names']

# Feature engineering function
def prepare_input(data):
    input_data = pd.DataFrame([data], columns=[
        'Age', 'Weight', 'Height', 'Neck', 'Chest', 'Abdomen',
        'Hip', 'Thigh', 'Knee', 'Ankle', 'Biceps', 'Forearm', 'Wrist'
    ])
    input_data['BMI'] = (input_data['Weight'] * 0.453592) / ((input_data['Height'] * 0.0254) ** 2)
    input_data['Waist_Hip_Ratio'] = input_data['Abdomen'] / input_data['Hip']
    input_data['Age_Weight_Interaction'] = input_data['Age'] * input_data['Weight']
    input_data['Chest_Abdomen_Ratio'] = input_data['Chest'] / input_data['Abdomen']
    return input_data

# Prediction function
def predict_body_fat(age, weight, height, neck, chest, abdomen, hip, thigh, knee, ankle, biceps, forearm, wrist):
    data = [age, weight, height, neck, chest, abdomen, hip, thigh, knee, ankle, biceps, forearm, wrist]
    input_data = prepare_input(data)
    input_scaled = scaler.transform(input_data[feature_names])
    prediction = model.predict(input_scaled)[0]
    prediction = np.clip(prediction, 2.0, 50.0)

    # Category
    if prediction < 14:
        category = "âœ… Athletic/Fit range"
    elif prediction < 25:
        category = "âš ï¸ Average range"
    else:
        category = "â— Above average - consider consulting healthcare provider"

    return f"{prediction:.1f}%", category

# Example profiles
examples = [
    [25, 165, 70, 36.5, 93, 78, 94, 56, 36, 22, 31, 27, 17.5],  # Athletic
    [35, 185, 69, 38, 102, 92, 100, 60, 38, 23, 32, 28, 18],    # Average
    [45, 215, 68, 40, 112, 105, 108, 64, 40, 24, 34, 29, 19]    # Overweight
]

# Gradio interface
with gr.Blocks(title="ðŸ’ª Body Fat Percentage Predictor") as demo:
    gr.Markdown("## ðŸ’ª Body Fat Percentage Predictor")
    gr.Markdown(f"Using **{model_data['model_name']}** | RÂ² = {model_data['metrics']['Test RÂ²']:.3f}")
    gr.Markdown("---")

    with gr.Tab("Quick Demo"):
        profile = gr.Dropdown(["Athletic (25yo)", "Average (35yo)", "Overweight (45yo)"], label="Select profile")
        demo_output = gr.Textbox(label="Predicted Body Fat")
        demo_category = gr.Textbox(label="Category")
        demo_btn = gr.Button("Predict")

        def demo_predict(profile_choice):
            idx = {"Athletic (25yo)":0, "Average (35yo)":1, "Overweight (45yo)":2}[profile_choice]
            pred, cat = predict_body_fat(*examples[idx])
            return pred, cat

        demo_btn.click(demo_predict, inputs=profile, outputs=[demo_output, demo_category])

    with gr.Tab("Manual Input"):
        with gr.Row():
            with gr.Column():
                age = gr.Number(label="Age", value=30, precision=0)
                weight = gr.Number(label="Weight (lbs)", value=180)
                height = gr.Number(label="Height (inches)", value=70)
                abdomen = gr.Number(label="Abdomen (cm)", value=90)
            with gr.Column():
                neck = gr.Number(label="Neck (cm)", value=37)
                chest = gr.Number(label="Chest (cm)", value=100)
                hip = gr.Number(label="Hip (cm)", value=100)
                thigh = gr.Number(label="Thigh (cm)", value=60)
            with gr.Column():
                wrist = gr.Number(label="Wrist (cm)", value=18)
                knee = gr.Number(label="Knee (cm)", value=38)
                biceps = gr.Number(label="Biceps (cm)", value=32)
                ankle = gr.Number(label="Ankle (cm)", value=23)
                forearm = gr.Number(label="Forearm (cm)", value=28)

        manual_output = gr.Textbox(label="Predicted Body Fat")
        manual_category = gr.Textbox(label="Category")
        manual_btn = gr.Button("Calculate")

        manual_btn.click(
            predict_body_fat,
            inputs=[age, weight, height, neck, chest, abdomen, hip, thigh, knee, ankle, biceps, forearm, wrist],
            outputs=[manual_output, manual_category]
        )

    gr.Markdown("---")
    gr.Markdown("""
    **About:** This tool predicts body fat percentage from body measurements using machine learning.
    No special equipment needed - just a tape measure. This is an estimation tool, not medical advice.
    """)

demo.launch()

